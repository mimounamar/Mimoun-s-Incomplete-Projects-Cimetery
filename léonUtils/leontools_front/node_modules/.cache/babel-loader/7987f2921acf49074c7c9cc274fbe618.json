{"ast":null,"code":"import _slicedToArray from\"/Users/mimoun/WebstormProjects/leontools-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import homeIcon from'../assets/images/icon_home.png';import'bootstrap-icons/font/bootstrap-icons.css';import jwtDecode from\"jwt-decode\";import{ErrorWrapper,LoginContainer,LoginPicture,LoginTitle,LoginWrapper,LoginPictureContainer}from\"../styled/Login.styled\";import getUserFromDb from\"../api/getUserFromDb\";import registerUser from\"../api/registerUser\";import getUserIp from\"../helpers/getUserIp\";import createSession from\"../api/createSession\";import randomText from\"../helpers/randomText\";import{useNavigate}from\"react-router-dom\";import getSessionFromDb from\"../api/getSessionFromDb\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Login(){var navigate=useNavigate();function redirectUser(){var sessionId=sessionStorage.getItem('sessionId');if(sessionId){getSessionFromDb(sessionId).then(function(response){getUserFromDb(response.data.google_id).then(function(userResponse){userResponse.data.verified?navigate(\"/dashboard\",{replace:true}):navigate(\"/CGU\",{replace:true});});});}}redirectUser();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),errorString=_useState2[0],setErrorString=_useState2[1];function verifyUserValidity(response){var userObject=jwtDecode(response.credential);var userMail=userObject.email;var userDomain=userMail.split(\"@\")[1];if(userDomain!==(\"leonafricain.ma\"||\"elbilia.ma\")){setErrorString(\"Veuillez utiliser votre adresse mail professionnelle\");document.getElementById(\"error-wrapper\").style.display=\"block\";}else{setErrorString(\"\");document.getElementById(\"error-wrapper\").style.display=\"none\";handleLogin(userMail);}}function handleLogin(googleId){getUserFromDb(googleId).then(function(response){getUserIp().then(function(ipResponse){var userIp=ipResponse.data.ipAddress;var sessionId=randomText(10);createSession(googleId,userIp,sessionId).then(function(response){sessionStorage.setItem(\"sessionId\",sessionId);navigate(\"/dashboard\",{replace:true});});});}).catch(function(error){if(error.response&&error.response.status===404){registerUser(googleId).then(function(response){getUserIp().then(function(ipResponse){var userIp=ipResponse.data.ipAddress;var sessionId=randomText(10);createSession(googleId,userIp,sessionId).then(function(response){sessionStorage.setItem(\"sessionId\",sessionId);navigate(\"/CGU\",{replace:true});});});});}});}useEffect(function(){/*global google*/google.accounts.id.initialize({client_id:\"518591411336-6r7hes5r15e658cieinangeh7f39ctsb.apps.googleusercontent.com\",callback:verifyUserValidity});google.accounts.id.renderButton(document.getElementById(\"signInDiv\"),{theme:\"outline\",size:\"large\",shape:\"pill\"});});return/*#__PURE__*/_jsxs(LoginWrapper,{children:[/*#__PURE__*/_jsx(LoginPictureContainer,{children:/*#__PURE__*/_jsx(LoginPicture,{src:homeIcon})}),/*#__PURE__*/_jsxs(LoginContainer,{children:[/*#__PURE__*/_jsx(LoginTitle,{children:\"Connectez vous en utilisant Google\"}),/*#__PURE__*/_jsxs(ErrorWrapper,{id:\"error-wrapper\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-exclamation-triangle\",children:\" \"}),errorString]}),/*#__PURE__*/_jsx(\"div\",{id:\"signInDiv\"})]})]});}export default Login;","map":{"version":3,"names":["React","useEffect","useState","homeIcon","jwtDecode","ErrorWrapper","LoginContainer","LoginPicture","LoginTitle","LoginWrapper","LoginPictureContainer","getUserFromDb","registerUser","getUserIp","createSession","randomText","useNavigate","getSessionFromDb","Login","navigate","redirectUser","sessionId","sessionStorage","getItem","then","response","data","google_id","userResponse","verified","replace","errorString","setErrorString","verifyUserValidity","userObject","credential","userMail","email","userDomain","split","document","getElementById","style","display","handleLogin","googleId","ipResponse","userIp","ipAddress","setItem","catch","error","status","google","accounts","id","initialize","client_id","callback","renderButton","theme","size","shape"],"sources":["/Users/mimoun/WebstormProjects/leontools-frontend/src/pages/Login.js"],"sourcesContent":["import React, {useEffect, useState} from 'react';\nimport homeIcon from '../assets/images/icon_home.png'\nimport 'bootstrap-icons/font/bootstrap-icons.css'\nimport jwtDecode from \"jwt-decode\";\nimport {\n    ErrorWrapper,\n    LoginContainer,\n    LoginPicture,\n    LoginTitle,\n    LoginWrapper,\n    LoginPictureContainer\n} from \"../styled/Login.styled\";\nimport getUserFromDb from \"../api/getUserFromDb\";\nimport registerUser from \"../api/registerUser\";\nimport getUserIp from \"../helpers/getUserIp\";\nimport createSession from \"../api/createSession\";\nimport randomText from \"../helpers/randomText\";\nimport {useNavigate} from \"react-router-dom\";\nimport getSessionFromDb from \"../api/getSessionFromDb\";\n\nfunction Login() {\n\n    let navigate = useNavigate()\n\n    function redirectUser(){\n        const sessionId = sessionStorage.getItem('sessionId')\n        if(sessionId){\n            getSessionFromDb(sessionId).then(response => {\n                getUserFromDb(response.data.google_id).then(userResponse => {\n                    userResponse.data.verified ? navigate(\"/dashboard\", { replace: true }) : navigate(\"/CGU\", { replace: true })\n                })\n            })\n        }\n    }\n    redirectUser()\n\n    const [errorString, setErrorString] = useState(\"\")\n\n    function verifyUserValidity(response){\n        const userObject = jwtDecode(response.credential);\n        const userMail = userObject.email;\n        const userDomain = userMail.split(\"@\")[1];\n        if (userDomain !== (\"leonafricain.ma\" || \"elbilia.ma\")){\n            setErrorString(\"Veuillez utiliser votre adresse mail professionnelle\");\n            document.getElementById(\"error-wrapper\").style.display = \"block\";\n        }\n        else{\n            setErrorString(\"\");\n            document.getElementById(\"error-wrapper\").style.display = \"none\";\n            handleLogin(userMail)\n        }\n    }\n\n    function handleLogin(googleId){\n        getUserFromDb(googleId)\n            .then((response) => {\n                getUserIp().then(ipResponse => {\n                    const userIp = ipResponse.data.ipAddress\n                    const sessionId = randomText(10)\n                    createSession(googleId, userIp, sessionId).then(response => {\n                        sessionStorage.setItem(\"sessionId\", sessionId)\n                        navigate(\"/dashboard\", { replace: true })\n                    })\n                })\n        }).catch(error => {\n            if (error.response && error.response.status === 404) {\n                registerUser(googleId)\n                    .then(response => {\n                        getUserIp().then(ipResponse => {\n                            const userIp = ipResponse.data.ipAddress\n                            const sessionId = randomText(10)\n                            createSession(googleId, userIp, sessionId).then(response => {\n                                sessionStorage.setItem(\"sessionId\", sessionId)\n                                navigate(\"/CGU\", { replace: true })\n                            })\n                        })\n                    })\n            }\n        })\n\n    }\n\n    useEffect(() => {\n        /*global google*/\n        google.accounts.id.initialize({\n            client_id: \"518591411336-6r7hes5r15e658cieinangeh7f39ctsb.apps.googleusercontent.com\",\n            callback: verifyUserValidity\n        });\n        google.accounts.id.renderButton(\n            document.getElementById(\"signInDiv\"),\n            {theme:\"outline\", size:\"large\", shape:\"pill\"}\n        );\n    });\n\n\n    return (\n        <LoginWrapper>\n            <LoginPictureContainer>\n                <LoginPicture src={homeIcon}></LoginPicture>\n            </LoginPictureContainer>\n\n            <LoginContainer>\n                <LoginTitle>Connectez vous en utilisant Google</LoginTitle>\n                <ErrorWrapper id=\"error-wrapper\">\n                    <i className=\"bi bi-exclamation-triangle\"> </i>\n                    {errorString}\n                </ErrorWrapper>\n                <div id=\"signInDiv\"></div>\n            </LoginContainer>\n        </LoginWrapper>\n    );\n}\n\nexport default Login;"],"mappings":"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"},"metadata":{},"sourceType":"module"}