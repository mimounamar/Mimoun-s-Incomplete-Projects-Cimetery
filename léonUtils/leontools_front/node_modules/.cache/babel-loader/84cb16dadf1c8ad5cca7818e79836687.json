{"ast":null,"code":"import _slicedToArray from\"/Users/mimoun/WebstormProjects/leontools-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import homeIcon from'../assets/images/icon_home.png';import'bootstrap-icons/font/bootstrap-icons.css';import jwtDecode from\"jwt-decode\";import{ErrorWrapper,LoginContainer,LoginPicture,LoginTitle,LoginWrapper,LoginPictureContainer}from\"../styled/Login.styled\";import getUserFromDb from\"../api/getUserFromDb\";import registerUser from\"../api/registerUser\";import getUserIp from\"../helpers/getUserIp\";import createSession from\"../api/createSession\";import randomText from\"../helpers/randomText\";import{useNavigate}from\"react-router-dom\";import getSessionFromDb from\"../api/getSessionFromDb\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Login(){var navigate=useNavigate();function redirectUser(){var sessionId=sessionStorage.getItem('sessionId');if(sessionId){getSessionFromDb(sessionId).then(function(response){getUserFromDb(response.data.google_id).then(function(userResponse){userResponse.data.verified?navigate(\"/dashboard\",{replace:true}):navigate(\"/CGU\",{replace:true});});});}}redirectUser();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),errorString=_useState2[0],setErrorString=_useState2[1];function verifyUserValidity(response){var userObject=jwtDecode(response.credential);var userMail=userObject.email;var userDomain=userMail.split(\"@\")[1];if(userDomain!==(\"leonafricain.ma\"||\"elbilia.ma\")){setErrorString(\"Veuillez utiliser votre adresse mail professionnelle\");document.getElementById(\"error-wrapper\").style.display=\"block\";}else{setErrorString(\"\");document.getElementById(\"error-wrapper\").style.display=\"none\";handleLogin(userMail);}}function handleLogin(googleId){getUserFromDb(googleId).then(function(response){getUserIp().then(function(ipResponse){var userIp=ipResponse.data.ipAddress;var sessionId=randomText(10);createSession(googleId,userIp,sessionId).then(function(response){sessionStorage.setItem(\"sessionId\",sessionId);navigate(\"/dashboard\",{replace:true});});});}).catch(function(error){if(error.response&&error.response.status===404){registerUser(googleId).then(function(response){getUserIp().then(function(ipResponse){var userIp=ipResponse.data.ipAddress;var sessionId=randomText(10);createSession(googleId,userIp,sessionId).then(function(response){sessionStorage.setItem(\"sessionId\",sessionId);navigate(\"/CGU\",{replace:true});});});});}});}useEffect(function(){/*global google*/google.accounts.id.initialize({client_id:\"518591411336-6r7hes5r15e658cieinangeh7f39ctsb.apps.googleusercontent.com\",callback:verifyUserValidity});google.accounts.id.renderButton(document.getElementById(\"signInDiv\"),{theme:\"outline\",size:\"large\",shape:\"pill\"});});return/*#__PURE__*/_jsxs(LoginWrapper,{children:[/*#__PURE__*/_jsx(LoginPictureContainer,{children:/*#__PURE__*/_jsx(LoginPicture,{src:homeIcon})}),/*#__PURE__*/_jsxs(LoginContainer,{children:[/*#__PURE__*/_jsx(LoginTitle,{children:\"Connectez vous en utilisant Google\"}),/*#__PURE__*/_jsxs(ErrorWrapper,{id:\"error-wrapper\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-exclamation-triangle\",children:\" \"}),errorString]}),/*#__PURE__*/_jsx(\"div\",{id:\"signInDiv\"})]})]});}export default Login;","map":null,"metadata":{},"sourceType":"module"}